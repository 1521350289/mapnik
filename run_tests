#!/bin/bash

failures=0

source ./localize.sh

# mapnik-settings.env is an optional file to store
# environment variables that should be used before
# running tests like PROJ_LIB, GDAL_DATA, and ICU_DATA
# These do not normally need to be set except when
# building against binary versions of dependencies like
# done via bootstrap.sh
if [[ -f mapnik-settings.env ]]; then
    source mapnik-settings.env
fi

./test/unit/run 
failures=$((failures+$?))

if [ -n "$(find test/standalone/ -maxdepth 1 -name '*-bin' -print -quit)" ]; then
    for FILE in test/standalone/*-bin; do 
        ${FILE};
      failures=$((failures+$?))
    done
fi

exit $failures